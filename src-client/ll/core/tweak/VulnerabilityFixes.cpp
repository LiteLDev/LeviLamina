#include "ll/api/event/EventBus.h"
#include "ll/api/memory/Hook.h"
#include "mc/certificates/Certificate.h"
#include "mc/network/NetworkConnection.h"
#include "mc/network/ServerNetworkHandler.h"
#include "mc/network/packet/SubChunkRequestPacket.h"
#include "mc/world/Minecraft.h"
#include "nlohmann/json.hpp"

namespace ll::vulnerability_fixes {
LL_TYPE_INSTANCE_HOOK(
    SubChunkRequestHook,
    HookPriority::Highest,
    ServerNetworkHandler,
    &ServerNetworkHandler::$handle,
    void,
    NetworkIdentifier const&     source,
    SubChunkRequestPacket const& packet
) {
    if (packet.mSubChunkPosOffsets->size() > 1000) {
        return;
    }
    return origin(source, packet);
}

void enableFixes() { static memory::HookRegistrar<SubChunkRequestHook> registrar; }
} // namespace ll::vulnerability_fixes
